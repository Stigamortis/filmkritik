<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filmkritik Analys - Sentimentanalys</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <style>
        /* Samma CSS som tidigare */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #0f171e;
            color: #fff;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: linear-gradient(to right, #0f171e, #1a242f);
            padding: 20px 0;
            border-bottom: 1px solid #303a44;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 28px;
            font-weight: bold;
            color: #f5c518;
            margin-bottom: 15px;
        }

        .logo i {
            font-size: 32px;
        }

        .tagline {
            color: #aaa;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
            padding: 40px 0;
        }

        .analysis-section {
            background-color: #1a242f;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
        }

        .section-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #f5c518;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-area {
            margin-bottom: 25px;
        }

        .input-label {
            display: block;
            margin-bottom: 10px;
            font-size: 18px;
            color: #ddd;
        }

        textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            background-color: #0f171e;
            border: 1px solid #303a44;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            resize: vertical;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #f5c518;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: #f5c518;
            color: #000;
        }

        .btn-primary:hover {
            background-color: #e0b50f;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: #2c3e50;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #34495e;
        }

        .btn-test {
            background-color: #9b59b6;
            color: white;
        }

        .btn-test:hover {
            background-color: #8e44ad;
        }

        .btn-debug {
            background-color: #1a242f;
            color: #3498db;
            border: 1px solid #3498db;
        }

        .btn-debug:hover {
            background-color: #3498db;
            color: white;
        }

        .results-section {
            background-color: #1a242f;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .results-title {
            font-size: 24px;
            color: #f5c518;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sentiment-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .sentiment-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            padding: 25px;
            border-radius: 10px;
            width: 200px;
            transition: all 0.3s;
            opacity: 0.6;
        }

        .sentiment-option.active {
            opacity: 1;
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
        }

        .sentiment-option.positive.active {
            background: linear-gradient(to bottom right, rgba(46, 204, 113, 0.2), rgba(39, 174, 96, 0.1));
            border: 2px solid #2ecc71;
        }

        .sentiment-option.negative.active {
            background: linear-gradient(to bottom right, rgba(231, 76, 60, 0.2), rgba(192, 57, 43, 0.1));
            border: 2px solid #e74c3c;
        }

        .sentiment-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .positive .sentiment-icon {
            color: #2ecc71;
        }

        .negative .sentiment-icon {
            color: #e74c3c;
        }

        .sentiment-label {
            font-size: 24px;
            font-weight: bold;
        }

        .sentiment-percentage {
            font-size: 36px;
            font-weight: bold;
        }

        .positive .sentiment-percentage {
            color: #2ecc71;
        }

        .negative .sentiment-percentage {
            color: #e74c3c;
        }

        .progress-container {
            margin-top: 20px;
        }

        .progress-bar {
            height: 20px;
            background-color: #0f171e;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            width: 50%;
            background: linear-gradient(to right, #e74c3c, #f5c518, #2ecc71);
            border-radius: 10px;
            transition: width 0.8s ease-out;
        }

        .progress-labels {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #aaa;
        }

        .analysis-text {
            background-color: #0f171e;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            border-left: 4px solid #f5c518;
        }

        .analysis-text h4 {
            margin-bottom: 10px;
            color: #f5c518;
        }

        .debug-panel {
            background-color: #1a242f;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #3498db;
        }

        .debug-panel h4 {
            color: #3498db;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .debug-output {
            font-family: monospace;
            background-color: #0f171e;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 12px;
            color: #ddd;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            line-height: 1.4;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 4px solid #f5c518;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        footer {
            margin-top: 40px;
            padding: 30px 0;
            border-top: 1px solid #303a44;
            text-align: center;
            color: #aaa;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <i class="fas fa-film"></i>
                <span>Filmkritik Analys - DEBUG</span>
            </div>
            <div class="tagline">
                Debug-version för att felsöka sentimentanalys-modellen
            </div>
        </div>
    </header>

    <div class="container">
        <main class="main-content">
            <section class="analysis-section">
                <h2 class="section-title">
                    <i class="fas fa-bug"></i>
                    Debug Analys
                </h2>
                <div class="input-area">
                    <label for="review-text" class="input-label">
                        Testtext för analys:
                    </label>
                    <textarea id="review-text">This movie was absolutely fantastic! The acting was superb and the plot was engaging.</textarea>
                    
                    <div class="button-group">
                        <button id="analyze-btn" class="btn btn-primary">
                            <i class="fas fa-play"></i>
                            Kör Analys
                        </button>
                        <button id="test-positive-btn" class="btn btn-test">
                            <i class="fas fa-thumbs-up"></i>
                            Test Positiv
                        </button>
                        <button id="test-negative-btn" class="btn btn-test" style="background-color: #e74c3c;">
                            <i class="fas fa-thumbs-down"></i>
                            Test Negativ
                        </button>
                        <button id="hardcoded-test-btn" class="btn btn-debug">
                            <i class="fas fa-code"></i>
                            Hardcoded Test
                        </button>
                    </div>
                    
                    <div class="loading" id="loading-indicator">
                        <div class="spinner"></div>
                        <p>Bearbetar...</p>
                    </div>
                </div>
                
                <div class="debug-panel">
                    <h4><i class="fas fa-terminal"></i> Debug Utdata</h4>
                    <div class="debug-output" id="debug-output">
                        Väntar på att starta...
                    </div>
                </div>
            </section>

            <section class="results-section">
                <div class="results-header">
                    <h2 class="results-title">
                        <i class="fas fa-chart-bar"></i>
                        Resultat
                    </h2>
                    <div class="confidence-level">
                        Konfidens: <span id="confidence-value">-</span>
                    </div>
                </div>
                
                <div class="sentiment-display">
                    <div class="sentiment-option negative" id="negative-sentiment">
                        <div class="sentiment-icon">
                            <i class="fas fa-frown"></i>
                        </div>
                        <div class="sentiment-label">Negativ</div>
                        <div class="sentiment-percentage" id="negative-percentage">50%</div>
                    </div>
                    
                    <div class="sentiment-option positive" id="positive-sentiment">
                        <div class="sentiment-icon">
                            <i class="fas fa-smile"></i>
                        </div>
                        <div class="sentiment-label">Positiv</div>
                        <div class="sentiment-percentage" id="positive-percentage">50%</div>
                    </div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 50%;"></div>
                    </div>
                    <div class="progress-labels">
                        <span>Negativ (50%)</span>
                        <span>Positiv (50%)</span>
                    </div>
                </div>
                
                <div class="analysis-text">
                    <h4>Analys:</h4>
                    <p id="analysis-output">Ingen analys utförd än. Klicka på "Kör Analys" för att börja.</p>
                </div>
            </section>
        </main>
        
        <footer>
            <p>Filmkritik Analys - Debug Version | TensorFlow.js Model Test</p>
            <p>Modell: ./tfjs_model/model.json | Input Shape: [null, 256]</p>
        </footer>
    </div>

    <script>
        // DOM Elements
        const reviewTextarea = document.getElementById('review-text');
        const analyzeBtn = document.getElementById('analyze-btn');
        const testPositiveBtn = document.getElementById('test-positive-btn');
        const testNegativeBtn = document.getElementById('test-negative-btn');
        const hardcodedTestBtn = document.getElementById('hardcoded-test-btn');
        const loadingIndicator = document.getElementById('loading-indicator');
        const positivePercentage = document.getElementById('positive-percentage');
        const negativePercentage = document.getElementById('negative-percentage');
        const positiveSentiment = document.getElementById('positive-sentiment');
        const negativeSentiment = document.getElementById('negative-sentiment');
        const progressFill = document.getElementById('progress-fill');
        const analysisOutput = document.getElementById('analysis-output');
        const confidenceValue = document.getElementById('confidence-value');
        const debugOutput = document.getElementById('debug-output');
        
        // Global variables
        let model = null;
        let metadata = null;
        const SEQUENCE_LENGTH = 256;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            logDebug('=== SYSTEM START ===');
            logDebug('Laddar TensorFlow.js modell...');
            
            try {
                analyzeBtn.disabled = true;
                testPositiveBtn.disabled = true;
                testNegativeBtn.disabled = true;
                hardcodedTestBtn.disabled = true;
                
                // Först, testa om metadata finns
                logDebug('1. Testar att ladda metadata.json...');
                const metadataResponse = await fetch('./tfjs_model/metadata.json');
                
                if (!metadataResponse.ok) {
                    throw new Error(`Kunde inte ladda metadata.json: ${metadataResponse.status}`);
                }
                
                metadata = await metadataResponse.json();
                logDebug(`✓ Metadata laddad. Vocab size: ${metadata.vocabulary_size || 'N/A'}`);
                logDebug(`  Max length: ${metadata.max_len || 'N/A'}`);
                logDebug(`  Word index keys: ${metadata.word_index ? Object.keys(metadata.word_index).length : 'N/A'}`);
                
                // Visa några exempelord
                if (metadata.word_index) {
                    const sampleWords = ['good', 'bad', 'movie', 'great', 'terrible'];
                    const foundWords = [];
                    sampleWords.forEach(word => {
                        if (metadata.word_index[word]) {
                            foundWords.push(`${word}:${metadata.word_index[word]}`);
                        }
                    });
                    logDebug(`  Exempel ord: ${foundWords.join(', ')}`);
                }
                
                // Ladda modellen
                logDebug('2. Laddar modell från model.json...');
                model = await tf.loadLayersModel('./tfjs_model/model.json');
                logDebug('✓ Modell laddad!');
                
                // Analysera modellens input/output
                if (model.inputs && model.inputs[0]) {
                    const inputShape = model.inputs[0].shape;
                    logDebug(`  Input shape: [${inputShape.join(', ')}]`);
                    
                    if (inputShape[1] !== SEQUENCE_LENGTH) {
                        logDebug(`  ⚠️  Modell förväntar ${inputShape[1]} tokens, vi använder ${SEQUENCE_LENGTH}`);
                    }
                }
                
                if (model.outputs && model.outputs[0]) {
                    const outputShape = model.outputs[0].shape;
                    logDebug(`  Output shape: [${outputShape.join(', ')}]`);
                }
                
                // Testa modellen med en enkel input direkt
                logDebug('3. Testar modellen med enkel input...');
                await testModelWithSimpleInput();
                
                // Aktivera knappar
                analyzeBtn.disabled = false;
                testPositiveBtn.disabled = false;
                testNegativeBtn.disabled = false;
                hardcodedTestBtn.disabled = false;
                
                logDebug('✓ System redo för analys!');
                
            } catch (error) {
                logDebug(`❌ FEL: ${error.message}`);
                logDebug('Stack: ' + error.stack);
                analysisOutput.textContent = `Fel vid initiering: ${error.message}`;
            }
            
            // Setup event listeners
            setupEventListeners();
        });
        
        function setupEventListeners() {
            analyzeBtn.addEventListener('click', analyzeText);
            
            testPositiveBtn.addEventListener('click', function() {
                reviewTextarea.value = "This movie was absolutely fantastic! The acting was superb and the plot was engaging. One of the best films I've seen this year. Highly recommended!";
                analyzeText();
            });
            
            testNegativeBtn.addEventListener('click', function() {
                reviewTextarea.value = "A complete waste of time. Terrible acting, awful dialogue, and a boring plot. I hated every minute of this film. Do not recommend to anyone.";
                analyzeText();
            });
            
            hardcodedTestBtn.addEventListener('click', runHardcodedTest);
        }
        
        function logDebug(message) {
            const timestamp = new Date().toLocaleTimeString();
            debugOutput.textContent += `[${timestamp}] ${message}\n`;
            debugOutput.scrollTop = debugOutput.scrollHeight;
            console.log(`[DEBUG] ${message}`);
        }
        
        function clearDebug() {
            debugOutput.textContent = '';
        }
        
        async function testModelWithSimpleInput() {
            try {
                // Skapa en enkel test-sekvens
                const testSequence = new Array(SEQUENCE_LENGTH).fill(0);
                
                // Sätt några värden som inte är noll
                testSequence[0] = 1;
                testSequence[1] = 2;
                testSequence[2] = 3;
                
                const testInput = tf.tensor2d([testSequence], [1, SEQUENCE_LENGTH]);
                
                logDebug(`  Test input shape: [${testInput.shape.join(', ')}]`);
                logDebug(`  Test input värden [0-5]: ${Array.from(testInput.dataSync()).slice(0, 6).join(', ')}`);
                
                const prediction = model.predict(testInput);
                const result = await prediction.data();
                
                logDebug(`  Test resultat: ${result[0].toFixed(6)}`);
                logDebug(`  Test tolkning: ${result[0] > 0.5 ? 'Positiv' : 'Negativ'} (${(result[0] * 100).toFixed(1)}%)`);
                
                testInput.dispose();
                prediction.dispose();
                
            } catch (error) {
                logDebug(`  ❌ Test misslyckades: ${error.message}`);
            }
        }
        
        async function analyzeText() {
            const text = reviewTextarea.value.trim();
            
            if (!text) {
                alert('Ange text att analysera.');
                return;
            }
            
            if (!model || !metadata) {
                alert('Modellen inte redo.');
                return;
            }
            
            loadingIndicator.style.display = 'block';
            analyzeBtn.disabled = true;
            
            try {
                logDebug('\n=== NY ANALYS STARTAR ===');
                logDebug(`Text: "${text.substring(0, 50)}${text.length > 50 ? '...' : ''}"`);
                
                // Steg 1: Tokenisera texten
                const tokens = tokenizeText(text);
                logDebug(`Tokeniserad: ${tokens.length} tokens`);
                logDebug(`Exempel tokens: ${tokens.slice(0, 10).join(', ')}`);
                
                // Steg 2: Konvertera till indices
                const indices = convertTokensToIndices(tokens);
                logDebug(`Indices: ${indices.length} värden`);
                logDebug(`Exempel indices: ${indices.slice(0, 10).join(', ')}`);
                
                // Steg 3: Skapa sekvens med rätt längd
                const sequence = createSequence(indices);
                logDebug(`Sekvens: ${sequence.length} värden (måste vara ${SEQUENCE_LENGTH})`);
                
                // Steg 4: Skapa tensor
                const inputTensor = tf.tensor2d([sequence], [1, SEQUENCE_LENGTH]);
                logDebug(`Tensor shape: [${inputTensor.shape.join(', ')}]`);
                logDebug(`Tensor värden [0-5]: ${Array.from(inputTensor.dataSync()).slice(0, 6).join(', ')}`);
                
                // Steg 5: Göra prediktion
                logDebug('Gör prediktion...');
                const startTime = Date.now();
                const prediction = model.predict(inputTensor);
                const result = await prediction.data();
                const inferenceTime = Date.now() - startTime;
                
                logDebug(`Prediktion resultat: ${result[0]}`);
                logDebug(`Inference tid: ${inferenceTime}ms`);
                
                // Steg 6: Visa resultat
                const positiveProb = result[0];
                const negativeProb = 1 - positiveProb;
                
                updateResults(positiveProb, negativeProb, text);
                
                // Rensa tensors
                inputTensor.dispose();
                prediction.dispose();
                
                logDebug('=== ANALYS SLUTFÖRD ===\n');
                
            } catch (error) {
                logDebug(`❌ Analysfel: ${error.message}`);
                logDebug(error.stack);
                analysisOutput.textContent = `Fel: ${error.message}`;
            } finally {
                loadingIndicator.style.display = 'none';
                analyzeBtn.disabled = false;
            }
        }
        
        function tokenizeText(text) {
            // Enkel tokenisering
            return text.toLowerCase()
                .replace(/[^\w\s']/g, ' ')
                .replace(/\s+/g, ' ')
                .trim()
                .split(/\s+/)
                .filter(token => token.length > 0);
        }
        
        function convertTokensToIndices(tokens) {
            const indices = [];
            const unknownWords = [];
            const wordIndex = metadata.word_index || {};
            
            for (const token of tokens) {
                let index = wordIndex[token];
                
                if (!index) {
                    // Försök hitta variationer
                    const variations = getWordVariations(token);
                    for (const variation of variations) {
                        if (wordIndex[variation]) {
                            index = wordIndex[variation];
                            break;
                        }
                    }
                }
                
                if (!index) {
                    // Använd UNK token eller 1
                    index = wordIndex['<UNK>'] || wordIndex['unk'] || wordIndex['<unk>'] || 1;
                    unknownWords.push(token);
                }
                
                indices.push(index);
            }
            
            if (unknownWords.length > 0) {
                logDebug(`Okända ord (${unknownWords.length}): ${unknownWords.slice(0, 5).join(', ')}${unknownWords.length > 5 ? '...' : ''}`);
            }
            
            return indices;
        }
        
        function getWordVariations(word) {
            const variations = [word];
            
            // Enkel stemming
            if (word.endsWith('s') && word.length > 1) {
                variations.push(word.slice(0, -1)); // remove 's'
            }
            if (word.endsWith('ing') && word.length > 3) {
                variations.push(word.slice(0, -3)); // remove 'ing'
                variations.push(word.slice(0, -3) + 'e'); // e.g., making -> make
            }
            if (word.endsWith('ed') && word.length > 2) {
                variations.push(word.slice(0, -2)); // remove 'ed'
                variations.push(word.slice(0, -1)); // remove 'd'
            }
            if (word.endsWith('ly') && word.length > 2) {
                variations.push(word.slice(0, -2)); // remove 'ly'
            }
            
            return variations;
        }
        
        function createSequence(indices) {
            const sequence = new Array(SEQUENCE_LENGTH).fill(0);
            
            // Kopiera indices eller trunkera
            const length = Math.min(indices.length, SEQUENCE_LENGTH);
            for (let i = 0; i < length; i++) {
                sequence[i] = indices[i];
            }
            
            return sequence;
        }
        
        function updateResults(positiveProb, negativeProb, text) {
            const positivePercent = Math.round(positiveProb * 100);
            const negativePercent = Math.round(negativeProb * 100);
            
            // Uppdatera UI
            positivePercentage.textContent = `${positivePercent}%`;
            negativePercentage.textContent = `${negativePercent}%`;
            
            progressFill.style.width = `${positivePercent}%`;
            confidenceValue.textContent = `${Math.round(Math.max(positiveProb, negativeProb) * 100)}%`;
            
            // Uppdatera aktiv sentiment
            if (positiveProb > 0.5) {
                positiveSentiment.classList.add('active');
                negativeSentiment.classList.remove('active');
            } else {
                negativeSentiment.classList.add('active');
                positiveSentiment.classList.remove('active');
            }
            
            // Visa analys
            const sentiment = positiveProb > 0.5 ? 'POSITIV' : 'NEGATIV';
            const sentimentColor = positiveProb > 0.5 ? '#2ecc71' : '#e74c3c';
            
            analysisOutput.innerHTML = `
                <strong style="color: ${sentimentColor}">${sentiment}</strong> sentiment
                <br><br>
                <strong>Sannolikhet:</strong> ${positivePercent}% positiv, ${negativePercent}% negativ
                <br>
                <strong>Text:</strong> "${text.substring(0, 80)}${text.length > 80 ? '...' : ''}"
            `;
            
            // Uppdatera progress labels
            document.querySelector('.progress-labels').innerHTML = `
                <span>Negativ (${negativePercent}%)</span>
                <span>Positiv (${positivePercent}%)</span>
            `;
        }
        
        // HARDCODED TEST för att isolera problemet
        async function runHardcodedTest() {
            logDebug('\n=== HARDCODED TEST START ===');
            
            try {
                // Test 1: Alla nollor
                logDebug('Test 1: Alla nollor');
                const zeros = new Array(SEQUENCE_LENGTH).fill(0);
                await runTensorTest(zeros, 'Nollor');
                
                // Test 2: Alla ettor
                logDebug('Test 2: Alla ettor');
                const ones = new Array(SEQUENCE_LENGTH).fill(1);
                await runTensorTest(ones, 'Ettor');
                
                // Test 3: Linjär sekvens
                logDebug('Test 3: Linjär sekvens 1-256');
                const linear = Array.from({length: SEQUENCE_LENGTH}, (_, i) => (i % 100) + 1);
                await runTensorTest(linear, 'Linjär');
                
                // Test 4: Simulerad mening med kända ord
                logDebug('Test 4: Simulerad mening');
                
                // Hitta några kända ord-index
                const wordIndex = metadata.word_index || {};
                const knownWords = {
                    'the': wordIndex['the'] || 1,
                    'movie': wordIndex['movie'] || 2,
                    'good': wordIndex['good'] || 3,
                    'bad': wordIndex['bad'] || 4,
                    'great': wordIndex['great'] || 5
                };
                
                logDebug(`Kända ord-index: ${JSON.stringify(knownWords)}`);
                
                // Skapa en simulerad mening: "the movie was good and great"
                const simulated = [
                    knownWords['the'],
                    knownWords['movie'],
                    10, // was (antagande)
                    knownWords['good'],
                    11, // and (antagande)
                    knownWords['great']
                ];
                
                // Fyll resten med padding
                const simulatedSequence = [...simulated, ...new Array(SEQUENCE_LENGTH - simulated.length).fill(0)];
                await runTensorTest(simulatedSequence, 'Simulerad mening');
                
                // Test 5: Extremt positiv och negativ
                logDebug('Test 5: Extremvärden test');
                await testExtremeCases();
                
            } catch (error) {
                logDebug(`❌ Hardcoded test fel: ${error.message}`);
            }
            
            logDebug('=== HARDCODED TEST SLUT ===\n');
        }
        
        async function runTensorTest(sequenceArray, testName) {
            const inputTensor = tf.tensor2d([sequenceArray], [1, SEQUENCE_LENGTH]);
            
            try {
                const prediction = model.predict(inputTensor);
                const result = await prediction.data();
                
                logDebug(`  ${testName}: ${result[0].toFixed(6)} (${(result[0] * 100).toFixed(2)}%)`);
                
                // Visa om det ändras från 0.5
                if (Math.abs(result[0] - 0.5) > 0.01) {
                    logDebug(`  ⭐ RESULTAT ÄNDRAS! Skillnad från 0.5: ${(result[0] - 0.5).toFixed(4)}`);
                }
                
                prediction.dispose();
            } catch (error) {
                logDebug(`  ${testName}: ERROR - ${error.message}`);
            }
            
            inputTensor.dispose();
        }
        
        async function testExtremeCases() {
            // Testa om modellen ens kan ge annat än 0.5
            
            // Fall 1: Många höga värden (simulerar många kända ord)
            const highValues = new Array(SEQUENCE_LENGTH).fill(0).map((_, i) => 100 + (i % 900));
            await runTensorTest(highValues, 'Höga värden (100-999)');
            
            // Fall 2: Växlande mönster
            const pattern = new Array(SEQUENCE_LENGTH).fill(0).map((_, i) => i % 2 === 0 ? 10 : 500);
            await runTensorTest(pattern, 'Växlande mönster');
            
            // Fall 3: Alla samma värde (förutom 0 och 1)
            const allSame = new Array(SEQUENCE_LENGTH).fill(42);
            await runTensorTest(allSame, 'Alla 42');
        }
    </script>
</body>
</html>
